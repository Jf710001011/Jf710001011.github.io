<!DOCTYPE HTML>
<html lang="en">




<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Lab-Static-Analysis, Hunter|Hacker|Coder|Artist">
    <meta name="description" content="信念与认知">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>


    <title>Lab-Static-Analysis | Jf71o0x1o1l</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Jf71o0x1o1l" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


    

                <body>
                    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Jf71o0x1o1l</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Jf71o0x1o1l</div>
        <div class="logo-desc">
            
            信念与认知
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

                        



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Lab-Static-Analysis</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Java/">
                                <span class="chip bg-color">Java</span>
                            </a>
                        
                            <a href="/tags/Static-Analysis/">
                                <span class="chip bg-color">Static-Analysis</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Lab/" class="post-category">
                                Lab
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2023-12-09
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2023-09-23
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    6.7k
                </div>
                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="活跃变量分析和迭代求解器">1. 活跃变量分析和迭代求解器</h3>
<h4 id="回顾">回顾</h4>
<ol type="1">
<li>transer function<img
src="https://s2.loli.net/2023/08/26/fo29NwqQgGMXOIr.png"
alt="image-20230826182222303" /></li>
</ol>
<h4 id="任务">任务</h4>
<ol type="1">
<li>第一个任务是实现 <code>LiveVariableAnalysis</code> 中的如下
API：<img src="https://s2.loli.net/2023/08/26/MeRVIOUlGwE2nj1.webp"
alt="corresponding algorithm location" />
<ul>
<li>SetFact newBoundaryFact(CFG)</li>
<li>SetFact newInitialFact()</li>
<li>void meetInto(SetFact,SetFact)</li>
<li>boolean transferNode(Stmt,SetFact,SetFact)</li>
</ul></li>
<li>第二个任务是实现上面提到的 <code>Solver</code> 类的两个方法：</li>
</ol>
<ul>
<li>Solver.initializeBackward(CFG,DataflowResult)</li>
<li>IterativeSolver.doSolveBackward(CFG,DataflowResult)</li>
</ul>
<h4 id="实现">实现</h4>
<ol type="1">
<li><p>项目结构<img
src="https://s2.loli.net/2023/08/26/XVpeZTI1QywYsj7.png"
alt="image-20230826205741382" /></p></li>
<li><p>需要了解的类：</p>
<ol type="1">
<li><p><code>pascal.taie.analysis.dataflow.fact.DataflowResult</code>用于维护数据流分析的
CFG 中的 fact。你可以通过它的 API 获取、设置 CFG 节点的
<code>IN facts</code> 和 <code>OUT facts</code></p>
<pre class="language-java" data-language="java"><code class="language-java">pascal.taie.analysis.dataflow.fact.DataflowResult</code></pre></li>
<li><p><code>pascal.taie.analysis.graph.cfg.CFG</code></p></li>
<li><p><code>pascal.taie.analysis.dataflow.solver.Solver</code></p></li>
<li><p><code>pascal.taie.analysis.dataflow.solver.IterativeSolver</code></p></li>
</ol></li>
<li><p><code>pascal/taie/analysis/dataflow/analysis/LiveVariableAnalysis.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">public SetFact&lt;Var&gt; newBoundaryFact(CFG&lt;Stmt&gt; cfg) &#123;
    &#x2F;&#x2F; TODO - finish me
    return new SetFact&lt;&gt;();
&#125;
   
@Override
public SetFact&lt;Var&gt; newInitialFact() &#123;
    &#x2F;&#x2F; TODO - finish me
    return new SetFact&lt;&gt;();
&#125;
   
@Override
public void meetInto(SetFact&lt;Var&gt; fact, SetFact&lt;Var&gt; target) &#123;
    &#x2F;&#x2F; TODO - finish me
    target.union(fact);
&#125;
   
@Override
public boolean transferNode(Stmt stmt, SetFact&lt;Var&gt; in, SetFact&lt;Var&gt; out) &#123;
    &#x2F;&#x2F; TODO - finish me
    SetFact&lt;Var&gt; newInFact &#x3D; new SetFact&lt;&gt;();
    newInFact.union(out);
   
    if(stmt.getDef().isPresent()) &#123;
        LValue def &#x3D; stmt.getDef().get();
        if(def instanceof  Var) &#123;
            newInFact.remove((Var) def);
        &#125;
    &#125;
   
    for (RValue use: stmt.getUses()) &#123;
        if (use instanceof Var) &#123;
            newInFact.add((Var) use);
        &#125;
    &#125;
   
    if(!newInFact.equals(in)) &#123;
        in.set(newInFact);
        return true;
    &#125;
    return false;
&#125;</code></pre></li>
<li><p><code>pascal/taie/analysis/dataflow/solver/IterativeSolver.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">protected void initializeBackward(CFG&lt;Node&gt; cfg, DataflowResult&lt;Node, Fact&gt; result) &#123;
    &#x2F;&#x2F; TODO - finish me
    result.setInFact(cfg.getExit(), analysis.newBoundaryFact(cfg));
    for(Node node : cfg.getNodes()) &#123;
        if (cfg.isExit(node)) continue;
        result.setInFact(node, analysis.newInitialFact());
        result.setOutFact(node, analysis.newInitialFact());
    &#125;
&#125;
   </code></pre></li>
<li><p><code>IterativeSolver.doSolveBackward(CFG,DataflowResult)</code></p>
<pre class="language-java" data-language="java"><code class="language-java">protected void doSolveBackward(CFG&lt;Node&gt; cfg, DataflowResult&lt;Node, Fact&gt; result) &#123;
    &#x2F;&#x2F; TODO - finish me
   
    boolean changed &#x3D; true;
   
    while (changed) &#123;
        changed &#x3D; false;
   
        for (Node node : cfg.getNodes()) &#123;
            if (cfg.isExit(node)) continue;
   
            for (Node succNode : cfg.getSuccsOf(node)) &#123;
                analysis.meetInto(result.getInFact(succNode), result.getOutFact(node));
            &#125;
   
            if (analysis.transferNode(node, result.getInFact(node), result.getOutFact(node))) changed &#x3D; true;
        &#125;
    &#125;
&#125;</code></pre></li>
</ol>
<h3 id="常量传播和-worklist-求解器">2：常量传播和 Worklist 求解器</h3>
<h4 id="需要理解的类">需要理解的类</h4>
<ol type="1">
<li><p><code>pascal.taie.ir.exp.IntLiteral</code>： 每个 IntLiteral
类的实例都表示一个程序中的整数字面量</p></li>
<li><p><code>pascal.taie.ir.exp.BinaryExp</code>：
这个类代表程序中的二元表达式。这个类的各个子类对应了表 1
中的不同种类的二元表达式，并且每个子类中都有一个内部<a
target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/javaOO/enum.html">枚举类型open
in new window</a>用于表示该类支持的运算符。例如枚举类型
<code>ArithmeticExp.Op</code>
就代表了<code>ArithmeticExp</code>（算术表达式类）所支持的运算符，也就是
<code>+ - * /</code> 和 <code>%</code>。</p>
<ol type="1">
<li><p>需要指出的是，在 Tai-e 中，<code>BinaryExp</code>
的两个操作数都是 <code>Var</code> 类型的。例如下面的语句</p>
<pre class="language-java" data-language="java"><code class="language-java">x &#x3D; y + 6;</code></pre>
<p>在 Tai-e 中会被转化成如下的 IR：</p>
<pre class="language-java" data-language="java"><code class="language-java">%intconst0 &#x3D; 6;     &#x2F;&#x2F; %intconst* are temp variables introduced
x &#x3D; y + %intconst0; &#x2F;&#x2F; by Tai-e to hold constant int values</code></pre></li>
</ol></li>
<li><p><code>pascal.taie.ir.stmt.DefinitionStmt</code></p>
<p>这是 Stmt 的一个子类。它表示了程序中所有的赋值语句，（即形如 x = y 或
x = m(…) 的语句）。</p></li>
<li><p><code>pascal.taie.analysis.dataflow.analysis.DataflowAnalysis</code></p>
<p>这是具体数据流分析算法需要实现的接口。和<a
target="_blank" rel="noopener" href="https://tai-e.pascal-lab.net/pa1.html">作业 1</a>
一样，它会被求解器调用。</p></li>
<li><p><code>pascal.taie.analysis.dataflow.analysis.constprop.Value</code></p>
<p>这个类表示了常量分析中格上的抽象值 (见第 6 讲课件的第 238
页)。它的代码和注释解释了它的用法。你应该用下列的静态方法获取格上抽象值（即该类的实例）：</p>
<p><code>Value getNAC():</code> 返回 NAC <code>Value getUndef()</code>:
返回 UNDEF <code>Value makeConstant(int)</code>:
返回给定整数在格上对应的抽象值</p></li>
<li><p><code>pascal.taie.analysis.dataflow.analysis.constprop.CPFact</code></p>
<p>这个类表示常量传播中的 data
facts，即一个从变量（Var）到格上抽象值（Value）的映射</p></li>
<li><p><code>pascal.taie.analysis.dataflow.analysis.constprop.ConstantPropagation</code></p>
<p>这个类实现了
DataflowAnalysis。你需要在其中编写完整的常量传播算法</p></li>
</ol>
<h4 id="实现-1">实现</h4>
<ol type="1">
<li><p><code>A2/tai-e/src/main/java/pascal/taie/analysis/dataflow/analysis/constprop/ConstantPropagation.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">@Override
public CPFact newBoundaryFact(CFG&lt;Stmt&gt; cfg) &#123;
    CPFact fact &#x3D; new CPFact();
    List&lt;Var&gt; vars &#x3D; cfg.getIR().getParams();
    for (Var var : vars) &#123;
        if (canHoldInt(var))
            fact.update(var, Value.getNAC());
    &#125;
    return fact;
&#125;
   
@Override
public CPFact newInitialFact() &#123;
    return new CPFact();
&#125;
   
@Override
public void meetInto(CPFact fact, CPFact target) &#123;
    &#x2F;&#x2F; Find a bug here, &quot;fact.ketSet()&quot; instead of &quot;target.ketSet()&quot;.
    for (Var var : fact.keySet()) &#123;
        target.update(var, meetValue(fact.get(var), target.get(var)));
    &#125;
&#125;
   
&#x2F;**
 * Meets two Values.
 *&#x2F;
public Value meetValue(Value v1, Value v2) &#123;
    if (v1.isNAC() || v2.isNAC()) &#123;
        return Value.getNAC();
    &#125;
    if (v1.isUndef()) &#123;
        return v2;
    &#125;
    if (v2.isUndef()) &#123;
        return v1;
    &#125;
    if (v1.getConstant() &#x3D;&#x3D; v2.getConstant()) &#123;
        return Value.makeConstant(v1.getConstant());
    &#125;
    return Value.getNAC();
&#125;
   
@Override
public boolean transferNode(Stmt stmt, CPFact in, CPFact out) &#123;
    if (stmt instanceof DefinitionStmt&lt;?,?&gt;) &#123;
        LValue lv &#x3D; ((DefinitionStmt&lt;?, ?&gt;) stmt).getLValue();
        RValue rv &#x3D; ((DefinitionStmt&lt;?, ?&gt;) stmt).getRValue();
        if (lv instanceof Var &amp;&amp; canHoldInt((Var)lv))&#123;
            CPFact tf &#x3D; in.copy();
            tf.update((Var)lv, evaluate(rv, in));
            return out.copyFrom(tf);
        &#125;
    &#125;
    return out.copyFrom(in);
&#125;</code></pre></li>
<li><p><code>A2/tai-e/src/main/java/pascal/taie/analysis/dataflow/solver/Solver.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">protected void initializeForward(CFG&lt;Node&gt; cfg, DataflowResult&lt;Node, Fact&gt; result) &#123;
    Node entry_node &#x3D; cfg.getEntry();
    result.setOutFact(entry_node, analysis.newBoundaryFact(cfg));
    result.setInFact(entry_node, analysis.newBoundaryFact(cfg));
    for (Node node : cfg) &#123;
        if (!cfg.isEntry(node)) &#123;
            result.setOutFact(node, analysis.newInitialFact());
            result.setInFact(node, analysis.newInitialFact());
        &#125;
    &#125;</code></pre></li>
<li><p><code>A2/tai-e/src/main/java/pascal/taie/analysis/dataflow/solver/WorkListSolver.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">@Override
protected void doSolveForward(CFG&lt;Node&gt; cfg, DataflowResult&lt;Node, Fact&gt; result) &#123;
    Queue&lt;Node&gt; work_list &#x3D; new ArrayDeque&lt;&gt;();
    for (Node node:cfg) &#123;
        work_list.add(node);
    &#125;
    while (!work_list.isEmpty()) &#123;
        Node node &#x3D; work_list.poll();
        Fact out &#x3D; result.getOutFact(node);
        Fact in &#x3D; result.getInFact(node);
        for (Node pred_node : cfg.getPredsOf(node)) &#123;
            analysis.meetInto(result.getOutFact(pred_node), in);
        &#125;
        if(analysis.transferNode(node, in, out)) &#123;
            for (Node succ : cfg.getSuccsOf(node)) &#123;
                if (!work_list.contains(succ)) &#123;
                    work_list.add(succ);
                &#125;
            &#125;
        &#125;
    &#125;
&#125;</code></pre></li>
</ol>
<hr />
<h3 id="死代码检测">3. 死代码检测</h3>
<ol type="1">
<li><p>组合前两次作业中实现的分析方法：<strong>活跃变量分析</strong>和<strong>常量传播</strong>，来实现一个
Java 的死代码检测算法</p></li>
<li><p>死代码指的是程序中不可达的（unreachable）代码（即不会被执行的代码），或者是执行结果永远不会被其他计算过程用到的代码。去除死代码可以在不影响程序输出的前提下简化程序、提高效率</p>
<ol type="1">
<li><strong>不可达代码</strong>（unreachable
code）和<strong>无用赋值</strong>（dead assignment）</li>
</ol></li>
<li><p><strong>控制流不可达代码</strong>（control-flow unreachable
code）和<strong>分支不可达代码</strong>（unreachable branch）</p></li>
<li><p>控制流不可达的。比如，由于返回语句是一个方法的出口，所以跟在它后面的代码是不可达的。例如在下面的代码中，第
4 行和第 5 行的代码是控制流不可达的：</p>
<pre class="language-java" data-language="java"><code class="language-java">int controlFlowUnreachable() &#123;
    int x &#x3D; 1;
    return x;
    int z &#x3D; 42; &#x2F;&#x2F; control-flow unreachable code
    foo(z); &#x2F;&#x2F; control-flow unreachable code
&#125;</code></pre>
<p><strong>检测方式</strong>：这样的代码可以很简单地利用所在方法的控制流图（CFG，即
control-flow graph）检测出来。我们只需要从方法入口开始，遍历 CFG
并标记可达语句。当遍历结束时，那些没有被标记的语句就是控制流不可达的。</p></li>
<li><p>有时即使等号左边的变量 <code>x</code>
是无用变量，它所属的赋值语句 <code>x = expr</code>
也不能被去除，因为右边的表达式 <code>expr</code> 可能带有某些<a
target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/副作用_(计算机科学)">副作用open in
new window</a>。</p></li>
<li><p>为了简单起见，不需要考虑由删除死代码而产生的新的死代码。</p></li>
</ol>
<h4 id="实现-2">实现</h4>
<ol type="1">
<li><p>DeadCodeDetection.java</p>
<pre class="language-java" data-language="java"><code class="language-java">public class DeadCodeDetection extends MethodAnalysis &#123;

    public static final String ID &#x3D; &quot;deadcode&quot;;

    public DeadCodeDetection(AnalysisConfig config) &#123;
        super(config);
    &#125;

    @Override
    public Set&lt;Stmt&gt; analyze(IR ir) &#123;
        &#x2F;&#x2F; obtain CFG
        CFG&lt;Stmt&gt; cfg &#x3D; ir.getResult(CFGBuilder.ID);
        &#x2F;&#x2F; obtain result of constant propagation
        DataflowResult&lt;Stmt, CPFact&gt; constants &#x3D;
                ir.getResult(ConstantPropagation.ID);
        &#x2F;&#x2F; obtain result of live variable analysis
        DataflowResult&lt;Stmt, SetFact&lt;Var&gt;&gt; liveVars &#x3D;
                ir.getResult(LiveVariableAnalysis.ID);
        &#x2F;&#x2F; keep statements (dead code) sorted in the resulting set
        Set&lt;Stmt&gt; deadCode &#x3D; new TreeSet&lt;&gt;(Comparator.comparing(Stmt::getIndex));
        &#x2F;&#x2F; TODO - finish me
        &#x2F;&#x2F; Your task is to recognize dead code in ir and add it to deadCode
        Set&lt;Stmt&gt; liveCode &#x3D; new TreeSet&lt;&gt;(Comparator.comparing(Stmt::getIndex));
        Queue&lt;Stmt&gt; queue &#x3D; new LinkedList&lt;&gt;();
        queue.add(cfg.getEntry());
        while (!queue.isEmpty()) &#123;
            Stmt stmt &#x3D; queue.poll();
            if (stmt instanceof AssignStmt&lt;?, ?&gt; s &amp;&amp; s.getLValue() instanceof Var var) &#123;
                if (!liveVars.getResult(stmt).contains(var) &amp;&amp; hasNoSideEffect(s.getRValue())) &#123;
                    queue.addAll(cfg.getSuccsOf(stmt));
                    continue;
                &#125;
            &#125;
            &#x2F;&#x2F; 如果添加返回false,说明该语句已经存在于liveCode中了
            if (!liveCode.add(stmt)) &#123;
                continue;
            &#125;
            if (stmt instanceof If s) &#123;
                Value res &#x3D; ConstantPropagation.evaluate(s.getCondition(), constants.getInFact(stmt));
                if (res.isConstant()) &#123;
                    for (Edge&lt;Stmt&gt; edge : cfg.getOutEdgesOf(stmt)) &#123;
                        if ((res.getConstant() &#x3D;&#x3D; 1 &amp;&amp; edge.getKind() &#x3D;&#x3D; Edge.Kind.IF_TRUE) || (res.getConstant() &#x3D;&#x3D; 0 &amp;&amp; edge.getKind() &#x3D;&#x3D; Edge.Kind.IF_FALSE)) &#123;
                            queue.add(edge.getTarget());
                        &#125;
                    &#125;
                &#125; else &#123;
                    queue.addAll(cfg.getSuccsOf(stmt));
                &#125;
            &#125; else if (stmt instanceof SwitchStmt s) &#123;
                Value res &#x3D; ConstantPropagation.evaluate(s.getVar(), constants.getInFact(stmt));
                if (res.isConstant()) &#123;
                    AtomicBoolean gone &#x3D; new AtomicBoolean(false);
                    s.getCaseTargets().stream().filter(cse -&gt; cse.first() &#x3D;&#x3D; res.getConstant()).forEach(cse -&gt; &#123;
                        gone.set(true); queue.add(cse.second());
                    &#125;);
                    if(!gone.get()) &#123;
                        queue.add(s.getDefaultTarget());
                    &#125;
                &#125;else &#123;
                    queue.addAll(cfg.getSuccsOf(stmt));
                &#125;
            &#125;else &#123;
                queue.addAll(cfg.getSuccsOf(stmt))
            &#125;
        &#125;
        deadCode.addAll(cfg.getNodes());
        deadCode.removeAll(liveCode);
        deadCode.remove(cfg.getExit());

        return deadCode;
    &#125;</code></pre></li>
</ol>
<h3 id="类层次结构分析和过程间常量传播">4.
类层次结构分析和过程间常量传播</h3>
<h4 id="目的">目的</h4>
<ol type="1">
<li>实现一个基于类层次结构（下面简称为
<code>CHA</code>）的调用图（<code>call graph</code>）构造器</li>
<li>还需要实现一个
<code>worklist 求解器</code>来支持过程间数据流分析</li>
</ol>
<h4 id="实现类层次结构分析cha">实现类层次结构分析（CHA）</h4>
<ol type="1">
<li><p>Java
语言的四种方法调用：<code>invokestatic</code>、<code>invokespecial</code>、<code>invokeinterface</code>
和 <code>invokevirtual</code></p></li>
<li><p>Java 中的一些新特性会让方法调用的情形更复杂：比如 Java 8
开始允许接口定义非抽象方法（<a
target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">default
methodsopen in new window</a>）；还有从 Java 11
开始，<code>invokeinterface</code> 和 <code>invoke-virtual</code>
可以调用 private
方法了。这都会使我们构建调用图的过程变得更复杂。</p></li>
<li><p>需要了解的<code>类</code></p>
<ol type="1">
<li><p><code>pascal.taie.analysis.graph.callgraph.DefaultCallGraph</code></p>
<p>该类代表了程序的调用图。它提供了多样的 API（继承自类
<code>AbstractCallGraph</code>）来获取到调用图的信息</p></li>
<li><p><code>pascal.taie.analysis.graph.callgraph.CallKind</code></p>
<p>该枚举类型表示调用图中边的种类，包括
<code>INTERFACE</code>、<code>VIRTUAL</code>、<code>SPECIAL</code> 和
<code>STATIC</code>，它对应<a
target="_blank" rel="noopener" href="https://cs.nju.edu.cn/tiantan/software-analysis/Inter.pdf#page=21">第
7 讲</a>中介绍过的 Java 的四种调用类型（call kind）。</p></li>
<li><p><code>pascal.taie.analysis.graph.callgraph.Edge&lt;Invoke,JMethod&gt;</code></p>
<p>该类表示调用图中的边</p></li>
<li><p><code>pascal.taie.ir.stmt.Invoke</code> (subclass of
<code>Stmt</code>)</p>
<p>该类表示程序中的方法调用（举个例子：<code>x = o.m(a1,a2,…)</code>）以及调用图中的调用点</p>
<p>需要使用 <code>getMethodRef()</code>
来获取目标方法的签名信息。</p></li>
<li><p><code>pascal.taie.ir.proginfo.MethodRef</code>： Tai-e
中的目标方法引用，如调用点的目标方法。它包含了调用点所调用的目标方法的签名信息。</p>
<ol type="1">
<li><code>JClass getDeclaringClass()</code>：返回该方法签名的声明类，即声明该方法的类</li>
<li><code>Subsignature getSubsignature()</code>：返回被调用方法的子签名（<code>subsignature</code>）。稍后介绍子签名类——<code>Subsignature</code>。</li>
</ol></li>
<li><p><code>pascal.taie.language.classes.JMethod</code></p>
<p>该类表示 Tai-e 中的 Java 方法。每个 <code>JMethod</code>
的实例关联着一个方法并包含该方法的各种信息。</p></li>
<li><p><code>pascal.taie.language.classes.JClass</code></p>
<p>该类表示 Tai-e 中的 Java 类。每个 <code>JClass</code>
的实例关联着一个类并包含该类的各种信息。</p></li>
<li><p><code>pascal.taie.language.classes.Subsignature</code></p></li>
<li><p>举个例子，下面方法 foo 的子签名是：“<code>T foo(P,Q,R)</code>”
，而它的完整签名是：“<code>&lt;C: T foo(P,Q,R)&gt;</code>”。</p>
<pre class="language-java" data-language="java"><code class="language-java">class C &#123;
    T foo(P p, Q q, R r) &#123; … &#125;
&#125;</code></pre></li>
<li><p><code>pascal.taie.analysis.graph.callgraph.CHABuilder</code></p></li>
</ol></li>
</ol>
<h5 id="代码实现">代码实现</h5>
<ol type="1">
<li><p>算法流程<img
src="https://s2.loli.net/2023/09/16/mBSvCaAtZyPwnpY.png"
alt="image-20230916202239032" /></p></li>
<li><p>Code</p>
<pre class="language-java" data-language="java"><code class="language-java">private CallGraph&lt;Invoke, JMethod&gt; buildCallGraph(JMethod entry) &#123;
    	&#x2F;&#x2F; 
       DefaultCallGraph callGraph &#x3D; new DefaultCallGraph();
       callGraph.addEntryMethod(entry);
       &#x2F;&#x2F; TODO - check
       Queue&lt;JMethod&gt; workList &#x3D; new LinkedList&lt;&gt;();
       workList.add(entry);
       while(!workList.isEmpty())&#123;
           JMethod m &#x3D; workList.poll();
   
           if(callGraph.contains(m))&#123;
               continue;
           &#125;
           &#x2F;&#x2F; add m to RM
           callGraph.addReachableMethod(m);
           &#x2F;&#x2F; foreach call site cs in m do
           for(Stmt stmt : m.getIR().getStmts())&#123;
               if(stmt instanceof Invoke cs)&#123;
                   &#x2F;&#x2F; T &#x3D; Resolve(cs)
                   &#x2F;&#x2F; foreach target method m1 in T do
                   for(JMethod m1 : resolve(cs))&#123;
                       &#x2F;&#x2F; add cs-&gt;m1 to CG
                       callGraph.addEdge(new Edge&lt;&gt;(CallGraphs.getCallKind(cs), cs, m1));
                       &#x2F;&#x2F; add m1 to WL
                       workList.add(m1);
                   &#125;
               &#125;
           &#125;
       &#125;
       return callGraph;
   &#125;
   
   &#x2F;**
    * Resolves call targets (callees) of a call site via CHA.
    *&#x2F;
   private Set&lt;JMethod&gt; resolve(Invoke callSite) &#123;
       &#x2F;&#x2F; TODO - check
       &#x2F;&#x2F; T&#x3D;&#123;&#125;
       Set&lt;JMethod&gt; T &#x3D; new HashSet&lt;&gt;();
       &#x2F;&#x2F; m &#x3D; method signature at cs
       MethodRef methodRef &#x3D; callSite.getMethodRef();
       Subsignature subsignature &#x3D; methodRef.getSubsignature();
       JClass declaringClass &#x3D; methodRef.getDeclaringClass();
       JMethod m &#x3D; declaringClass.getDeclaredMethod(subsignature);
       &#x2F;&#x2F; if cs is static call Then
       &#x2F;&#x2F;      T &#x3D; &#123;m&#125;
       if (callSite.isStatic()) &#123;
           T.add(m);
       &#125;
       &#x2F;&#x2F; if cs is special call Then
       &#x2F;&#x2F;      Cm &#x3D; class type of m
       &#x2F;&#x2F;      T &#x3D; &#123;Dispatch(Cm,m)&#125;
       if (callSite.isSpecial()) &#123;
           T.add(dispatch(declaringClass, subsignature));
       &#125;
       &#x2F;&#x2F; if cs is a virtual call or interface Then
       if (callSite.isVirtual() || callSite.isInterface()) &#123;
           Queue&lt;JClass&gt; queue &#x3D; new LinkedList&lt;&gt;();
           queue.add(declaringClass);
   
           while (!queue.isEmpty()) &#123;
               JClass cur &#x3D; queue.poll();
               JMethod dispatchMethod &#x3D; dispatch(cur, subsignature);
               if (dispatchMethod !&#x3D; null) &#123;
                   T.add(dispatchMethod);
               &#125;
               if (cur.isInterface()) &#123;
                   queue.addAll(hierarchy.getDirectSubinterfacesOf(cur));
                   queue.addAll(hierarchy.getDirectImplementorsOf(cur));
               &#125; else &#123;
                   queue.addAll(hierarchy.getDirectSubclassesOf(cur));
               &#125;
           &#125;
       &#125;
       return T;
   &#125;
   
   &#x2F;**
    * Looks up the target method based on given class and method subsignature.
    *
    * @return the dispatched target method, or null if no satisfying method
    * can be found.
    *&#x2F;
   private JMethod dispatch(JClass c, Subsignature subsignature) &#123;
       &#x2F;&#x2F; TODO - check
       if (c &#x3D;&#x3D; null) &#123;
           return null;
       &#125;
   
       JMethod m &#x3D; c.getDeclaredMethod(subsignature);
       if (m !&#x3D; null &amp;&amp; !m.isAbstract()) &#123;
           return m;
       &#125;
       return dispatch(c.getSuperClass(), subsignature);
   &#125;</code></pre>
<p>在Java中,静态调用和特殊调用是两种不同的调用方式:</p>
<ol type="1">
<li>静态调用</li>
</ol>
<p>调用静态方法时,是直接按方法签名定位并调用的,目标方法是唯一确定的。例如:</p>
<pre class="language-java" data-language="java"><code class="language-java">Math.max(a, b); &#x2F;&#x2F; 直接调用Math类的静态max方法</code></pre>
<ol start="2" type="1">
<li>特殊调用</li>
</ol>
<p>特殊调用主要包括super()、this()等,它们调用的目标方法不是固定的,需要在运行时动态确定,因此需要特殊处理。例如:</p>
<pre class="language-java" data-language="java"><code class="language-java">super(); &#x2F;&#x2F; 调用父类构造函数,目标构造函数不是固定</code></pre></li>
</ol>
<h4 id="实现过程间常量传播">实现过程间常量传播</h4>
<ol type="1">
<li><p>过程间常量传播使用了
<em><code>edge transfer</code></em>，因此能够更准确地处理方法<strong>调用</strong>和<strong>返回</strong>所产生的过程间数据流。</p></li>
<li><p>举一个前向分析的例子，在传统的过程内数据流分析中，如果我们想计算一个节点的IN
fact，我们可以直接meet该节点的全部前驱的OUT fact：</p>
<figure>
<img src="https://s2.loli.net/2023/09/16/vLlxe3JBsFA4dpV.png"
alt="image-20230916161718531" />
<figcaption aria-hidden="true">image-20230916161718531</figcaption>
</figure>
<p>然而，在过程间数据流分析中，为了计算一个节点的 IN
fact，我们需要先对该节点的前驱的 OUT fact 应用 <em>edge
transfer</em>，然后把得到结果 meet 进该节点的 IN fact。</p></li>
<li><p>需要了解的类</p>
<ol type="1">
<li><p><code>pascal.taie.analysis.graph.icfg.ICFGEdge</code></p>
<p>该类是一个抽象类，它表示了 ICFG
中的边。而它有四个子类，分别关联着上一节中提到的四种 ICFG
边：<code>Normal Edge</code>、<code>CallToReturnEdge</code>、<code>CallEdge</code>、<code>ReturnEdge</code></p></li>
<li><p><code>pascal.taie.analysis.dataflow.inter.InterDataflowAnalysis</code></p>
<p>这是一个过程间数据流分析的接口</p></li>
<li><p><code>pascal.taie.analysis.dataflow.inter.AbstractInterDataflowAnalysis</code></p>
<p>该抽象类实现了 <code>InterDataflowAnalysis</code>，并为
<code>InterDataflowAnalysis</code> 的实现提供了一些基本的功能。</p></li>
<li><p><code>pascal.taie.analysis.dataflow.inter.InterConstantPropagation</code></p>
<p>该类继承自
<code>AbstractInterDataflowAnalysis</code>，并且定义了过程间常量传播</p></li>
<li><p><code>pascal.taie.ir.exp.InvokeExp</code></p>
<p>该类表示程序中的方法调用表达式</p></li>
</ol></li>
<li><p>实验的最后你就可以发现：与保守处理方法调用的<strong>过程内</strong>常量传播相比，<strong>过程间</strong>常量传播可以达到更好的精度。</p></li>
<li><p>Code</p>
<pre class="language-java" data-language="java"><code class="language-java">protected boolean transferCallNode(Stmt stmt, CPFact in, CPFact out) &#123;
        &#x2F;&#x2F; TODO - check
        boolean change &#x3D; false;

        for(Var key : in.keySet())&#123;
            change |&#x3D; out.update(key, in.get(key));
        &#125;
        return change;
    &#125;

    @Override
    protected boolean transferNonCallNode(Stmt stmt, CPFact in, CPFact out) &#123;
        &#x2F;&#x2F; TODO - check
        return cp.transferNode(stmt,in,out);
    &#125;

    @Override
    protected CPFact transferNormalEdge(NormalEdge&lt;Stmt&gt; edge, CPFact out) &#123;
        &#x2F;&#x2F; TODO - check
        return out.copy();
    &#125;

    @Override
    protected CPFact transferCallToReturnEdge(CallToReturnEdge&lt;Stmt&gt; edge, CPFact out) &#123;
        &#x2F;&#x2F; TODO - check
        CPFact ret &#x3D; out.copy();
        LValue L &#x3D; edge.getSource().getDef().orElse(null);
        if(L instanceof Var x)&#123;
            ret.remove(x);
        &#125;
        return ret;
    &#125;

    @Override
    protected CPFact transferCallEdge(CallEdge&lt;Stmt&gt; edge, CPFact callSiteOut) &#123;
        &#x2F;&#x2F; TODO - check
        CPFact ret &#x3D; new CPFact();

        List&lt;Var&gt; formal &#x3D; edge.getCallee().getIR().getParams();
        List&lt;Var&gt; args &#x3D; ((Invoke) edge.getSource()).getInvokeExp().getArgs();

        for(int i &#x3D; 0; i &lt; formal.size(); ++i)&#123;
            Var x &#x3D; formal.get(i);
            if(canHoldInt(x))&#123;
                ret.update(x, callSiteOut.get(args.get(i)));
            &#125;

        &#125;
        return ret;
    &#125;

    @Override
    protected CPFact transferReturnEdge(ReturnEdge&lt;Stmt&gt; edge, CPFact returnOut) &#123;
        &#x2F;&#x2F; TODO - check
        CPFact ret &#x3D; new CPFact();
        LValue L &#x3D; edge.getCallSite().getDef().orElse(null);

        if(L instanceof Var def &amp;&amp; canHoldInt(def))&#123;
            for(Var x : edge.getReturnVars())&#123;
                ret.update(def, cp.meetValue(ret.get(def), returnOut.get(x)));
            &#125;
        &#125;
        return ret;
    &#125;</code></pre></li>
</ol>
<h4 id="实现过程间-worklist-求解器">实现过程间 Worklist 求解器</h4>
<ol type="1">
<li><p>需要了解的类</p>
<ol type="1">
<li><p><code>pascal.taie.analysis.dataflow.fact.DataflowResult</code></p></li>
<li><p><code>pascal.taie.analysis.graph.icfg.ICFG</code></p>
<p>该类代表的是程序的过程间控制流图。</p></li>
<li><p><code>pascal.taie.analysis.dataflow.inter.InterSolver</code></p>
<p>该类是过程间数据流分析的求解器。</p></li>
</ol></li>
<li><p>Code</p>
<pre class="language-Java" data-language="Java"><code class="language-Java">private void initialize() &#123;
        &#x2F;&#x2F; TODO - check
        &#x2F;&#x2F; WL
        workList &#x3D; new LinkedList&lt;&gt;(icfg.getNodes());
        &#x2F;&#x2F; CG
        for(Node node : icfg)&#123;
            result.setOutFact(node, analysis.newInitialFact());
        &#125;
        icfg.entryMethods().forEach(method -&gt; &#123;
            Node entry &#x3D; icfg.getEntryOf(method);
            result.setOutFact(entry, analysis.newBoundaryFact(entry));
        &#125;);
    &#125;

    private void doSolve() &#123;
        &#x2F;&#x2F; TODO - check
        Queue&lt;Node&gt; workList &#x3D; new LinkedList&lt;&gt;(icfg.getNodes());
        while(!workList.isEmpty())&#123;
            Node node &#x3D; workList.poll();
            CPFact in &#x3D; new CPFact();
            CPFact out &#x3D; (CPFact) result.getOutFact(node);
            for(ICFGEdge&lt;Node&gt; edge : icfg.getInEdgesOf(node))&#123;
                analysis.meetInto(analysis.transferEdge(edge, result.getOutFact(edge.getSource())), (Fact) in);
            &#125;
            if(analysis.transferNode(node, (Fact) in, (Fact) out))&#123;
                icfg.getSuccsOf(node).forEach(workList::offer);
            &#125;
            result.setInFact(node, (Fact) in);
            result.setOutFact(node, (Fact) out);
        &#125;
    &#125;</code></pre></li>
</ol>
<h3 id="非上下文敏感指针分析">5. 非上下文敏感指针分析</h3>
<h4 id="前情提要">前情提要</h4>
<ol type="1">
<li>CHA的不准确性<img
src="https://s2.loli.net/2023/09/23/eR8If2mDTEp3bjB.png"
alt="image-20230923142616586" /></li>
<li>堆抽象</li>
<li>创建点抽象</li>
<li>何为<code>上下文敏感</code><img
src="https://s2.loli.net/2023/09/23/53AIlBp4xF1SiRt.png"
alt="image-20230923151950665" /></li>
<li>何为<code>流敏感</code><img
src="https://s2.loli.net/2023/09/23/b5NtTi2wOgaul4L.png"
alt="image-20230923153142011" /></li>
<li>指针分析处理的5种语句<img
src="https://s2.loli.net/2023/09/23/zQy4w7bst8LhTc1.png"
alt="image-20230923161613082" /></li>
<li>符号<img src="https://s2.loli.net/2023/09/23/6CJo5SNaZ3nPTQ2.png"
alt="image-20230923164447218" /></li>
<li>核心算法<img
src="https://s2.loli.net/2023/09/23/e9FOUXAdvQEPVSL.png"
alt="image-20230923211746724" /></li>
</ol>
<h4 id="实现指针分析">实现指针分析</h4>
<ol type="1">
<li><p>处理两种指针（<code>局部变量</code>和<code>实例字段</code>），为了使该指针分析更实用，将额外处理另两种指针（<code>静态字段</code>和<code>数组索引</code>）以及<code>静态方法调用</code>。</p></li>
<li><p>需要了解的<code>类</code></p>
<ol type="1">
<li><p><code>pascal.taie.ir.stmt.DefinitionStmt</code></p>
<p>它表示程序中所有的定义语句，例如 <code>x = y</code> 和
<code>x = m(…)</code>。在本lab中，所有影响指针的语句都是这个类的子类，</p></li>
<li><p><code>pascal.taie.ir.exp.Var</code></p>
<p>它表示 Tai-e IR 中的变量</p></li>
<li><p><code>pascal.taie.language.classes.JField</code></p>
<p>这个类表示程序中的各个字段。</p></li>
<li><p>指针分析相关的类</p>
<ol type="1">
<li><p><code>pascal.taie.analysis.pta.core.heap.Obj</code></p>
<p>表示指针分析中的抽象对象</p></li>
<li><p><code>pascal.taie.analysis.pta.core.heap.HeapModel</code></p>
<p>表示堆模型（即堆抽象），它用来对堆对象进行建模</p></li>
<li><p><code>pascal.taie.analysis.pta.ci.PointsToSet</code></p>
<p>指针集，即指针分析中的 <code>Obj</code> 集合</p></li>
<li><p><code>pascal.taie.analysis.pta.ci.Pointer</code></p>
<p>表示分析中的指针，即 PFG（指针流图，pointer flow
grpah）中的节点</p></li>
<li><p><code>pascal.taie.analysis.pta.ci.PointerFlowGraph</code></p>
<p>表示程序的指针流图。它还维护着从变量、静态字段、实例字段、数组索引到相应指针（即
PFG 节点）的映射，因此可以利用这个类的 API 获得各种指针</p></li>
<li><p><code>pascal.taie.analysis.pta.ci.WorkList</code></p>
<p>表示指针分析算法中的 worklist</p></li>
<li><p><code>pascal.taie.analysis.pta.ci.Solver</code></p>
<p>实现了一个上下文无关的指针分析求解器</p></li>
</ol></li>
</ol></li>
<li><p><code>Tai-e-assignments-wp/A5/Solver.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">private void addReachable(JMethod method) &#123;
    &#x2F;&#x2F; TODO - check
    if (!callGraph.contains(method)) &#123;
        callGraph.addReachableMethod(method);
        method.getIR().getStmts().forEach(stmt -&gt; stmt.accept(stmtProcessor));
    &#125;
&#125;
   
&#x2F;**
 * Processes statements in new reachable methods.
 *&#x2F;
private class StmtProcessor implements StmtVisitor&lt;Void&gt; &#123;
    &#x2F;&#x2F; TODO check
    @Override
    public Void visit(New stmt) &#123;
        workList.addEntry(pointerFlowGraph.getVarPtr(stmt.getLValue()),new PointsToSet(heapModel.getObj(stmt)) );
        return null;
    &#125;
    
    
 
        private void addPFGEdge(Pointer source, Pointer target) &#123;
    &#x2F;&#x2F; TODO - check
    if (pointerFlowGraph.addEdge(source,target)) &#123;
        if (!source.getPointsToSet().isEmpty()) &#123;
            workList.addEntry(target, source.getPointsToSet());
        &#125;
    &#125;
&#125;
   
&#x2F;**
 * Processes work-list entries until the work-list is empty.
 *&#x2F;
private void analyze() &#123;
    &#x2F;&#x2F; TODO - check
    while (!workList.isEmpty()) &#123;
        WorkList.Entry entry &#x3D; workList.pollEntry();
        Pointer ptr &#x3D; entry.pointer();
        PointsToSet delta &#x3D; propagate(ptr, entry.pointsToSet());
   
        if (ptr instanceof VarPtr varPtr) &#123;
            Var x &#x3D; varPtr.getVar();
   
            for (Obj obj : delta) &#123;
                for (StoreField storeField : x.getStoreFields()) &#123;
                    addPFGEdge(pointerFlowGraph.getVarPtr(storeField.getRValue()),
                            pointerFlowGraph.getInstanceField(obj,storeField.getFieldRef().resolve()));
                &#125;
                for (LoadField loadField : x.getLoadFields()) &#123;
                    addPFGEdge(pointerFlowGraph.getInstanceField(obj,loadField.getFieldRef().resolve()),
                            pointerFlowGraph.getVarPtr(loadField.getLValue()));
                &#125;
                for (StoreArray storeArray : x.getStoreArrays()) &#123;
                    addPFGEdge(pointerFlowGraph.getVarPtr(storeArray.getRValue()),
                            pointerFlowGraph.getArrayIndex(obj));
                &#125;
                for (LoadArray loadArray : x.getLoadArrays()) &#123;
                    addPFGEdge(pointerFlowGraph.getArrayIndex(obj),
                            pointerFlowGraph.getVarPtr(loadArray.getLValue()));
                &#125;
                processCall(x,obj);
            &#125;
        &#125;
    &#125;
&#125;
   
&#x2F;**
 * Propagates pointsToSet to pt(pointer) and its PFG successors,
 * returns the difference set of pointsToSet and pt(pointer).
 *&#x2F;
private PointsToSet propagate(Pointer pointer, PointsToSet pointsToSet) &#123;
    &#x2F;&#x2F; TODO - check
    PointsToSet delta &#x3D; new PointsToSet();
    PointsToSet has &#x3D; pointer.getPointsToSet();
   
    pointsToSet.objects().
            filter(ptr -&gt; !has.contains(ptr)).
            forEach(ptr -&gt; &#123;has.addObject(ptr);delta.addObject(ptr);&#125;);
   
    if (!delta.isEmpty()) &#123;
        pointerFlowGraph.getSuccsOf(pointer).forEach(succ -&gt; workList.addEntry(succ,delta));
    &#125;
    return delta;
&#125;
   
&#x2F;**
 * Processes instance calls when points-to set of the receiver variable changes.
 *
 * @param var the variable that holds receiver objects
 * @param recv a new discovered object pointed by the variable.
 *&#x2F;
private void processCall(Var var, Obj recv) &#123;
    &#x2F;&#x2F; TODO - check
    for (Invoke callSite : var.getInvokes()) &#123;
        JMethod method &#x3D; resolveCallee(recv, callSite);
        workList.addEntry(pointerFlowGraph.getVarPtr(method.getIR().getThis()),new PointsToSet(recv));
        if (callGraph.addEdge(new Edge&lt;&gt;(CallGraphs.getCallKind(callSite),callSite,method))) &#123;
            addReachable(method);
            pass(callSite,method);
        &#125;
    &#125;
&#125;</code></pre></li>
</ol>
<h3 id="上下文敏感的指针分析">6. 上下文敏感的指针分析</h3>
<h4 id="须知">须知</h4>
<ol type="1">
<li><p>在 Tai-e 上实现一个上下文敏感的 Java
指针分析框架，其中程序调用图的构建是伴随着指针分析一同进行的。另外，还需要实现几种具体的上下文敏感策略。在实现正确的情况下，上下文敏感的指针分析构建的调用图将会比使用非上下文敏感的指针分析（CIPTA）构建的调用图更精确。此外，不同的上下文敏感策略会对精度产生不同的影响</p></li>
<li><p>这一算法处理两类指针（即局部变量和实例字段（instance
field））和实例方法的调用。为了实现一个更加实用的指针分析，需要额外处理两类指针（即静态字段（static
field）和数组索引（array index））以及静态方法的调用。</p></li>
<li><p>需要了解的<code>类</code></p>
<ol type="1">
<li><p><code>pascal.taie.analysis.pta.core.cs.context.Context</code></p>
<p>表示上下文敏感的指针分析中的上下文</p></li>
<li><p><code>pascal.taie.analysis.pta.core.cs.element.CSElement</code></p>
<p>该类表示指针分析中需要用到上下文的元素，每个这样的元素都和一个上下文相关联。它有四个子类，分别表示四种需要用到上下文的元素：<img
src="https://s2.loli.net/2023/09/23/Cm4YxSQHk2AhgDe.webp"
alt="cselement-subclasses" /></p>
<ul>
<li><code>CSVar</code>：表示一个带上下文（<code>Context</code>）的变量（<code>Var</code>）。</li>
<li><code>CSObj</code>：表示一个带上下文（<code>Context</code>）的抽象对象（<code>Obj</code>）。</li>
<li><code>CSCallSite</code>：表示一个带上下文（<code>Context</code>）的调用点（<code>Invoke</code>）。</li>
<li><code>CSMethod</code>：表示一个带上下文（<code>Context</code>）的方法（<code>JMethod</code>）。</li>
</ul></li>
<li><p><code>pascal.taie.analysis.pta.core.cs.element.Pointer</code></p>
<p>该类表示上下文敏感指针分析中的指针，即 PFG（pointer flow
graph）中的节点</p></li>
<li><p><code>pascal.taie.analysis.pta.core.cs.element.CSManager</code></p>
<p>该类管理所有需要用到上下文的元素和所有上下文敏感的指针。也就是说，<code>CSElement</code>
或 <code>Pointer</code>
的所有子类的实例（每当你需要用到时）都需要通过这个类的相关 API
来取得。</p></li>
<li><p><code>pascal.taie.analysis.pta.core.cs.selector.ContextSelector</code></p>
<p>该类是上下文敏感指针分析框架和具体的上下文敏感策略（如调用点敏感、对象敏感等）之间的接口</p></li>
<li><p><code>pascal.taie.analysis.pta.core.cs.CSCallGraph</code></p>
<p>表示上下文敏感的调用图</p></li>
<li><p><code>pascal.taie.analysis.pta.pts.PointsToSet</code></p>
<p>表示指针集（points-to sets），即上下文敏感指针分析中
<code>CSObj</code> 的集合</p></li>
<li><p><code>pascal.taie.analysis.pta.pts.PointsToSetFactory</code></p>
<p>该类提供创建 <code>PointsToSet</code> 的静态工厂方法</p></li>
<li><p><code>pascal.taie.analysis.pta.cs.PointerFlowGraph</code></p>
<p>表示程序的指针流图 PFG</p></li>
<li><p><code>pascal.taie.analysis.pta.cs.WorkList</code></p>
<p>表示指针分析算法中的 WorkList。</p></li>
<li><p><code>pascal.taie.analysis.pta.cs.Solver</code></p>
<p>实现了一个上下文敏感的指针分析求解器</p></li>
</ol></li>
<li><p><code>Tai-e-assignments-wp/A6/Solver.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">private void addReachable(CSMethod csMethod) &#123;
    &#x2F;&#x2F; TODO - check
    if (!callGraph.contains(csMethod)) &#123;
        callGraph.addReachableMethod(csMethod);
        csMethod.getMethod().getIR().getStmts().forEach(stmt -&gt; stmt.accept(new StmtProcessor(csMethod)));
    &#125;
&#125;

public Void visit(New stmt) &#123;
    Obj obj &#x3D; heapModel.getObj(stmt       @Override
    public Void visit(New stmt) &#123;
        Obj obj &#x3D; heapModel.getObj(stmt);
        CSObj csObj &#x3D; csManager.getCSObj(contextSelector.selectHeapContext(csMethod, obj), obj);
        workList.addEntry(
                csManager.getCSVar(context,stmt.getLValue()),
                PointsToSetFactory.make(csObj)
        );
        return null;
    &#125;
   
    @Override
    public Void visit(Copy stmt) &#123;
        addPFGEdge(
                csManager.getCSVar(context,stmt.getRValue()),
                csManager.getCSVar(context,stmt.getLValue())
        );
        return null;
    &#125;
   
    @Override
    public Void visit(StoreField stmt) &#123;
        if (stmt.isStatic()) &#123;
            JField field &#x3D; stmt.getFieldRef().resolve();
            addPFGEdge(
                    csManager.getCSVar(context,stmt.getRValue()),
                    csManager.getStaticField(field)
            );
        &#125;
        return null;
    &#125;
   
    @Override
    public Void visit(LoadField stmt) &#123;
        if (stmt.isStatic()) &#123;
            JField field &#x3D; stmt.getFieldRef().resolve();
            addPFGEdge(
                    csManager.getStaticField(field),
                    csManager.getCSVar(context,stmt.getLValue())
            );
        &#125;
        return null;
    &#125;
   
    @Override
    public Void visit(Invoke stmt) &#123;
        if (stmt.isStatic()) &#123;
            JMethod method &#x3D; resolveCallee(null, stmt);
            Context context &#x3D; contextSelector.selectContext(csManager.getCSCallSite(this.context, stmt), method);
            CSMethod csMethod &#x3D; csManager.getCSMethod(context, method);
   
            callGraph.addEdge(
                    new Edge&lt;&gt;(CallGraphs.getCallKind(stmt),
                            csManager.getCSCallSite(this.context,stmt),
                            csMethod)
            );
            addReachable(csMethod);
            pass(csManager.getCSCallSite(this.context,stmt),csMethod);
        &#125;
        return null;
    &#125;
&#125;);
    CSObj csObj &#x3D; csManager.getCSObj(contextSelector.selectHeapContext(csMethod, obj), obj);
    workList.addEntry(
            csManager.getCSVar(context,stmt.getLValue()),
            PointsToSetFactory.make(csObj)
    );
    return null;
&#125;


private void addPFGEdge(Pointer source, Pointer target) &#123;
    &#x2F;&#x2F; TODO - check
    if (pointerFlowGraph.addEdge(source,target)) &#123;
        if (!source.getPointsToSet().isEmpty()) &#123;
            workList.addEntry(target, source.getPointsToSet());
        &#125;
    &#125;
&#125;
    
    
 private void analyze() &#123;
    &#x2F;&#x2F; TODO - check
    while (!workList.isEmpty()) &#123;
        WorkList.Entry entry &#x3D; workList.pollEntry();
        Pointer ptr &#x3D; entry.pointer();
        PointsToSet delta &#x3D; propagate(ptr, entry.pointsToSet());
   
        if (ptr instanceof CSVar varPtr) &#123;
            Context context &#x3D; varPtr.getContext();
            Var x &#x3D; varPtr.getVar();
   
            for (CSObj obj : delta) &#123;
                &#x2F;&#x2F; x.f &#x3D; y
                for (StoreField storeField : x.getStoreFields()) &#123;
                    addPFGEdge(
                            csManager.getCSVar(context,storeField.getRValue()),
                            csManager.getInstanceField(obj,storeField.getFieldRef().resolve())
                    );
                &#125;
                &#x2F;&#x2F; y &#x3D; x.f
                for (LoadField loadField : x.getLoadFields()) &#123;
                    addPFGEdge(
                            csManager.getInstanceField(obj,loadField.getFieldRef().resolve()),
                            csManager.getCSVar(context,loadField.getLValue())
                    );
                &#125;
                &#x2F;&#x2F; arr[*] &#x3D; y
                for (StoreArray storeArray : x.getStoreArrays()) &#123;
                    addPFGEdge(
                            csManager.getCSVar(context,storeArray.getRValue()),
                            csManager.getArrayIndex(obj)
                    );
                &#125;
                &#x2F;&#x2F; y &#x3D; arr[*]
                for (LoadArray loadArray : x.getLoadArrays()) &#123;
                    addPFGEdge(
                            csManager.getArrayIndex(obj),
                            csManager.getCSVar(context,loadArray.getLValue())
                    );
                &#125;
                processCall(varPtr,obj);
            &#125;
        &#125;
    &#125;
&#125;
   
&#x2F;**
 * Propagates pointsToSet to pt(pointer) and its PFG successors,
 * returns the difference set of pointsToSet and pt(pointer).
 *&#x2F;
private PointsToSet propagate(Pointer pointer, PointsToSet pointsToSet) &#123;
    &#x2F;&#x2F; TODO - check
    PointsToSet delta &#x3D; PointsToSetFactory.make();
    PointsToSet has &#x3D; pointer.getPointsToSet();
   
    pointsToSet.objects().
            filter(ptr -&gt; !has.contains(ptr)).
            forEach(ptr -&gt; &#123;has.addObject(ptr);delta.addObject(ptr);&#125;);
   
    if (!delta.isEmpty()) &#123;
        pointerFlowGraph.getSuccsOf(pointer).forEach(succ -&gt; workList.addEntry(succ,delta));
    &#125;
    return delta;
&#125;
   
&#x2F;**
 * Processes instance calls when points-to set of the receiver variable changes.
 *
 * @param recv    the receiver variable
 * @param recvObj set of new discovered objects pointed by the variable.
 *&#x2F;
private void processCall(CSVar recv, CSObj recvObj) &#123;
    &#x2F;&#x2F; TODO - check
    Context c &#x3D; recv.getContext();
    Var var &#x3D; recv.getVar();
   
    for (Invoke callSite : var.getInvokes()) &#123;
        JMethod callee &#x3D; resolveCallee(recvObj, callSite);
        CSCallSite csCallSite &#x3D; csManager.getCSCallSite(c, callSite);
   
        Context ct &#x3D; contextSelector.selectContext(csCallSite, recvObj, callee);
        workList.addEntry(csManager.getCSVar(ct,callee.getIR().getThis()),PointsToSetFactory.make(recvObj));
   
        CSMethod csCallee &#x3D; csManager.getCSMethod(ct, callee);
        if (callGraph.addEdge(new Edge&lt;&gt;(CallGraphs.getCallKind(callSite),csCallSite,csCallee))) &#123;
            addReachable(csCallee);
            pass(csCallSite,csCallee);
        &#125;
    &#125;
&#125;</code></pre></li>
<li><p><code>Tai-e-assignments-wp/A6/_1CallSelector.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">public Context selectContext(CSCallSite callSite, JMethod callee) &#123;
     &#x2F;&#x2F; TODO - check
     return ListContext.make(callSite.getCallSite());
 &#125;
   
 @Override
 public Context selectContext(CSCallSite callSite, CSObj recv, JMethod callee) &#123;
     &#x2F;&#x2F; TODO - check
     return ListContext.make(callSite.getCallSite());
 &#125;
   
 @Override
 public Context selectHeapContext(CSMethod method, Obj obj) &#123;
     &#x2F;&#x2F; TODO - check
     return getEmptyContext();
 &#125;</code></pre></li>
<li><p><code>Tai-e-assignments-wp/A6/_1ObjSelector.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">public Context selectContext(CSCallSite callSite, JMethod callee) &#123;
    &#x2F;&#x2F; TODO - check
    return getEmptyContext();
&#125;
   
@Override
public Context selectContext(CSCallSite callSite, CSObj recv, JMethod callee) &#123;
    &#x2F;&#x2F; TODO - check
    return ListContext.make(recv.getObject());
&#125;
   
@Override
public Context selectHeapContext(CSMethod method, Obj obj) &#123;
    &#x2F;&#x2F; TODO - check
    return getEmptyContext();
&#125;</code></pre></li>
<li><p><code>Tai-e-assignments-wp/A6/_1TypeSelector.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">public Context selectContext(CSCallSite callSite, JMethod callee) &#123;
    &#x2F;&#x2F; TODO - check
    return callSite.getContext();
&#125;
   
@Override
public Context selectContext(CSCallSite callSite, CSObj recv, JMethod callee) &#123;
    &#x2F;&#x2F; TODO - check
    return ListContext.make(recv.getObject().getContainerType());
&#125;
   
@Override
public Context selectHeapContext(CSMethod method, Obj obj) &#123;
    &#x2F;&#x2F; TODO - check
    return getEmptyContext();
&#125;</code></pre></li>
<li><p><code>Tai-e-assignments-wp/A6/_2CallSelector.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">public Context selectContext(CSCallSite callSite, JMethod callee) &#123;
     &#x2F;&#x2F; TODO - check
     Context oldContext &#x3D; callSite.getContext();
     if (oldContext.getLength() &gt;&#x3D; 1) &#123;
         return ListContext.make(oldContext.getElementAt(oldContext.getLength() - 1),callSite.getCallSite());
     &#125;
     return ListContext.make(callSite.getCallSite());
 &#125;
   
 @Override
 public Context selectContext(CSCallSite callSite, CSObj recv, JMethod callee) &#123;
     &#x2F;&#x2F; TODO - check
     return selectContext(callSite,callee);
 &#125;
   
 @Override
 public Context selectHeapContext(CSMethod method, Obj obj) &#123;
     &#x2F;&#x2F; TODO - check
     Context oldContext &#x3D; method.getContext();
     if (oldContext.getLength() &gt;&#x3D; 2) &#123;
         return ListContext.make(oldContext.getElementAt(oldContext.getLength() - 1));
     &#125;
     return oldContext;
 &#125;</code></pre></li>
<li><p><code>Tai-e-assignments-wp/A6/_2ObjSelector.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">public Context selectContext(CSCallSite callSite, JMethod callee) &#123;
    &#x2F;&#x2F; TODO - check
    return callSite.getContext();
&#125;
   
@Override
public Context selectContext(CSCallSite callSite, CSObj recv, JMethod callee) &#123;
    &#x2F;&#x2F; TODO - check
    Context oldContext &#x3D; recv.getContext();
    if (oldContext.getLength() &gt;&#x3D; 1) &#123;
        return ListContext.make(oldContext.getElementAt(oldContext.getLength()-1),recv.getObject());
    &#125;
    return ListContext.make(recv.getObject());
&#125;
   
@Override
public Context selectHeapContext(CSMethod method, Obj obj) &#123;
    &#x2F;&#x2F; TODO - check
    Context oldContext &#x3D; method.getContext();
    if (oldContext.getLength() &gt;&#x3D; 2) &#123;
        return ListContext.make(oldContext.getElementAt(oldContext.getLength()-1));
    &#125;
    return oldContext;
&#125;</code></pre></li>
<li><p><code>Tai-e-assignments-wp/A6/_2TypeSelector.java</code></p>
<pre class="language-java" data-language="java"><code class="language-java">public Context selectContext(CSCallSite callSite, CSObj recv, JMethod callee) &#123;
    &#x2F;&#x2F; TODO - check
    Context oldContext &#x3D; recv.getContext();
    if (oldContext.getLength() &gt;&#x3D; 1) &#123;
        return ListContext.make(oldContext.getElementAt(oldContext.getLength()-1),recv.getObject().getContainerType());
    &#125;
    
    return ListContext.make(recv.getObject().getContainerType());
&#125;
    
@Override
public Context selectHeapContext(CSMethod method, Obj obj) &#123;
    &#x2F;&#x2F; TODO - check
    Context oldContext &#x3D; method.getContext();
    if (oldContext.getLength() &gt;&#x3D; 2) &#123;
        return ListContext.make(oldContext.getElementAt(oldContext.getLength() - 1));
    &#125;
    return oldContext;
&#125;</code></pre></li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Jf71o0x1o1l</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://Jf710001011.github.io/2023/12/09/lab-static-analysis/">https://Jf710001011.github.io/2023/12/09/lab-static-analysis/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Jf71o0x1o1l</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Java/">
                                    <span class="chip bg-color">Java</span>
                                </a>
                            
                                <a href="/tags/Static-Analysis/">
                                    <span class="chip bg-color">Static-Analysis</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'U2qj9LBn7UhJFyVyb1bYDa9w-gzGzoHsz',
        appKey: 'Tg6wRvRlIfODtULeHu4P96zh',
        notify: 'true' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'en',
        placeholder: 'just go go'
    });
</script>

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2023/12/09/msi-afeterburner/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="MSI-afterburner">
                        
                        <span class="card-title">MSI-afterburner</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            电脑硬件情况实时显示
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-12-09
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Tools/" class="post-category">
                                    Tools
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Windows/">
                        <span class="chip bg-color">Windows</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/12/09/java/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="Java">
                        
                        <span class="card-title">Java</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Java Programming
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-12-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Programming/" class="post-category">
                                    Programming
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




                            <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023</span>
            
            <span id="year">2023</span>
            <a href="/about" target="_blank">Jf71o0x1o1l</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">238.7k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2023";
                    var startMonth = "2";
                    var startDate = "16";
                    var startHour = "24";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="/null" target="_blank">津ICP备Jf710001011号</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Jf710001011" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:lhhyp2333@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


                                <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

                                    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


                                        <script
                                            src="/libs/materialize/materialize.min.js"></script>
                                        <script
                                            src="/libs/masonry/masonry.pkgd.min.js"></script>
                                        <script
                                            src="/libs/aos/aos.js"></script>
                                        <script
                                            src="/libs/scrollprogress/scrollProgress.min.js"></script>
                                        <script
                                            src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
                                        <script
                                            src="/js/matery.js"></script>

                                        <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

                                            <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

                                                
                                                    <script
                                                        src="/libs/others/clicklove.js"
                                                        async="async"></script>
                                                    
                                                        
                                                            <script async
                                                                src="/libs/others/busuanzi.pure.mini.js"></script>
                                                            

                                                                

                                                                        

                                                                                
                                                                                        
                                                                                            <script
                                                                                                type="text/javascript"
                                                                                                color="0,0,255"
                                                                                                pointColor="0,0,255"
                                                                                                opacity='0.7'
                                                                                                zIndex="-1"
                                                                                                count="99"
                                                                                                src="/libs/background/canvas-nest.js"></script>
                                                                                            

                                                                                                

                                                                                                            
                                                                                                                <script
                                                                                                                    type="text/javascript"
                                                                                                                    src="/libs/background/ribbon-dynamic.js"
                                                                                                                    async="async"></script>
                                                                                                                

                                                                                                                    
                                                                                                                        <script
                                                                                                                            src="/libs/instantpage/instantpage.js"
                                                                                                                            type="module"></script>
                                                                                                                        
                                                                                                                            <script
                                                                                                                                type="text/javascript">
                                                                                                                                    //只在桌面版网页启用特效
                                                                                                                                    var windowWidth = $(window).width();
                                                                                                                                    if (windowWidth > 768) {
                                                                                                                                        document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
                                                                                                                                    }
                                                                                                                                </script>
                </body>

</html>